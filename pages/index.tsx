import type {NextPage} from "next";
import Head from "next/head";
// import Image from 'next/image'
import styles from "../styles/Home.module.scss";
import MainLayout from "../components/MainLayout";
import React, {useRef} from "react";
import {useEffect} from "react";
import Image from 'next/image'
import MobileLayout from "../components/MobileLayout";
import {BannerM, Features, History, Talent, tidyUrl, Titleswe} from "../components/utils";
import {GetServerSideProps, InferGetServerSidePropsType} from "next";


const Home: NextPage = ({talents, featuresM, honor,banner}: InferGetServerSidePropsType<typeof getServerSideProps>) => {

    return (
        <div>
            <Head>
                <title>关于我们｜浙江理工大学工业设计系</title>
                <meta name="description" content="Generated by create next app"/>
                <link rel="icon" href="/public/favicon.ico"/>
            </Head>
            <MobileLayout>
                <div className={styles.mainGraph}/>
                <div className={styles.swipper}>
                    <BannerM bannerData={banner}/>
                </div>
                <div className={styles.history}>
                    <div className={styles.title}>
                        <Titleswe zh="历史沿革" en="Development History"/>
                    </div>
                    <History/>
                </div>
                <div className={styles.feature}>
                    <div className={styles.title}>
                        <Titleswe zh="特色优势" en="Features and advantages"/>
                    </div>
                    <Features content={featuresM}/>
                </div>
                <div className={styles.honor}>
                    <div className={styles.title}>
                        <Titleswe zh="荣誉与成果" en="Honor and Achievement"/>
                    </div>
                    <div className={styles.honorImg}>
                        <Image src={tidyUrl(honor)} alt={"honor"} layout={"fill"} objectFit={"contain"}/>
                    </div>
                </div>
                <div className={styles.talent}>
                    <div className={styles.title}>
                        <Titleswe zh="人才培养" en="Cultivation of talents"/>
                    </div>
                    <Talent talents={talents}/>
                </div>
            </MobileLayout>
        </div>
    );
};


export const getServerSideProps: GetServerSideProps = async context => {
        const res = await fetch("http://127.0.0.1:1337/about-us");
        const data = await res.json() as any;
        const talents = data["talents"].map((e: any) => ({
            title: e.title,
            content: e.describe
        }))
        const featuresM: string[] = []
        data["features"].map((e: any) => {
            featuresM.push(e.title)
        })
        const honor = data["honor"].url
        const banner = {
            bannerItem1: {
                url: data["banner"]["bannerItems1"].url,
                coverUrl: data["banner"]["bannerItems1"].cover.url
            },
            bannerItem2: {
                url: data["banner"]["bannerItmes2"].url,
                coverUrl: data["banner"]["bannerItmes2"].cover.url
            },
            bannerItem3: {
                url: data["banner"]["bannerItem3"].url,
                coverUrl: data["banner"]["bannerItem3"].cover.url
            },
        }
        console.log(featuresM)
        return {
            props: {
                talents: talents,
                featuresM: featuresM,
                honor: honor,
                banner: banner
            },
        };
    }
;


export default Home;
